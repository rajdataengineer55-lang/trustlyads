rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- Admin Full Access ---
    // The admin (UID: 8dbJ55nXdEXaOrlV4XosUMOq5E83) can write, update, and delete anything.
    match /{document=**} {
      allow write: if request.auth.uid == '8dbJ55nXdEXaOrlV4XosUMOq5E83';
    }

    // --- Public Read Access ---
    // Anyone can read lists of offers, stories, and reviews.
    // They can also read individual documents if they are not hidden.
    match /offers/{offerId} {
      allow get: if resource.data.isHidden == false || request.auth.uid == '8dbJ55nXdEXaOrlV4XosUMOq5E83';
      allow list: if true;
    }

    match /stories/{storyId} {
      allow read: if true;
    }

    match /offers/{offerId}/reviews/{reviewId} {
      allow read: if true;
    }
  }
}
