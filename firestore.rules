rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Allow read-only access to stories and reviews through collection group queries
    match /{path=**}/stories/{storyId} {
      allow read: if true;
    }
    match /{path=**}/reviews/{reviewId} {
      allow read: if true;
    }

    // Rule for the `offers` collection
    match /offers/{offerId} {
      // Allow public read access
      allow read: if true;
      // Allow write access (create, update, delete) only for the specific admin user
      allow write: if request.auth != null && request.auth.token.email == 'dandurajkumarworld24@gmail.com';

      // Nested rule for reviews within an offer
      match /reviews/{reviewId} {
        // Only logged-in users can create reviews
        allow create: if request.auth != null;
        // No one can edit or delete reviews
        allow update, delete: if false;
      }
    }
    
    // Rule for the `followers` collection
    match /followers/{userId} {
      // Allow anyone to read follower data (e.g., for follower counts)
      allow read: if true; 
      // Allow a user to write (follow/unfollow) only to their own document
      allow write: if request.auth != null && request.auth.uid == userId;
    }

     // Rule for the `stories` collection
    match /stories/{storyId} {
      // Allow public read access
      allow read: if true;
      // Allow write access only for the admin
      allow write: if request.auth != null && request.auth.token.email == 'dandurajkumarworld24@gmail.com';
    }
  }
}