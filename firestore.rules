rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Rule for the 'offers' collection
    match /offers/{offerId} {
      // Anyone can read an offer if it is not hidden.
      allow read: if resource.data.isHidden == false;
      
      // Anyone can query the list of offers.
      allow list: if true;

      // Only the admin can create, update, or delete offers.
      allow write: if request.auth.uid == '8dbJ55nXdEXaOrlV4XosUMOq5E83';
    }

    // Rule for the 'stories' collection
    match /stories/{storyId} {
      // Anyone can read or query stories. This fixes the error.
      allow read: if true;

      // Only the admin can create, update, or delete stories.
      allow write: if request.auth.uid == '8dbJ55nXdEXaOrlV4XosUMOq5E83';
    }

    // Rule for the 'reviews' subcollection
    match /offers/{offerId}/reviews/{reviewId} {
      // Anyone can read reviews.
      allow read: if true;
      
      // Any authenticated user can create a review.
      allow create: if request.auth != null;
    }
  }
}
